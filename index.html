<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy to Figma - Teste de M√∫ltiplas Abordagens</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .method {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .method h3 {
            color: #0066cc;
            margin-top: 0;
        }
        
        .method p {
            color: #666;
            margin-bottom: 15px;
        }
        
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
            margin-right: 10px;
        }
        
        button:hover {
            background: #0052a3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .hidden-elements {
            position: absolute;
            left: -9999px;
            white-space: pre;
        }
        
        .inspector {
            margin-top: 30px;
            padding: 20px;
            background: #f1f3f4;
            border-radius: 8px;
        }
        
        .inspector h3 {
            margin-top: 0;
            color: #333;
        }
        
        .inspector textarea {
            width: 100%;
            height: 200px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            display: none;
        }
        
        .status.show {
            display: block;
        }
        
        .status.success {
            background: #28a745;
        }
        
        .status.error {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Teste: Copy to Figma</h1>
        <p style="text-align: center; color: #666;">
            Implementa√ß√£o de m√∫ltiplas abordagens para copiar componentes para o Figma
        </p>
        
        <!-- M√©todo 1: ClipboardItem com MIME types espec√≠ficos -->
        <div class="method">
            <h3>M√©todo 1: ClipboardItem com MIME Customizado</h3>
            <p>Usa ClipboardItem com text/html e application/figma-node personalizado</p>
            <button onclick="copyMethod1()">Testar M√©todo 1</button>
            <div id="result1" class="result" style="display: none;"></div>
        </div>
        
        <!-- M√©todo 2: execCommand com sele√ß√£o -->
        <div class="method">
            <h3>M√©todo 2: execCommand com Sele√ß√£o Manual</h3>
            <p>Usa document.execCommand('copy') ap√≥s selecionar elemento DOM</p>
            <button onclick="copyMethod2()">Testar M√©todo 2</button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>
        
        <!-- M√©todo 3: Clipboard API avan√ßado -->
        <div class="method">
            <h3>M√©todo 3: Multi-MIME com Data URLs</h3>
            <p>Combina text/html, text/plain e data URLs</p>
            <button onclick="copyMethod3()">Testar M√©todo 3</button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>
        
        <!-- M√©todo 4: Simula√ß√£o de origem Figma -->
        <div class="method">
            <h3>M√©todo 4: Headers e Metadata Figma</h3>
            <p>Simula headers e metadata que o Figma pode esperar</p>
            <button onclick="copyMethod4()">Testar M√©todo 4</button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>
        
        <!-- M√©todo 5: Abordagem h√≠brida -->
        <div class="method">
            <h3>M√©todo 5: Abordagem H√≠brida</h3>
            <p>Combina v√°rias t√©cnicas com fallback</p>
            <button onclick="copyMethod5()">Testar M√©todo 5</button>
            <div id="result5" class="result" style="display: none;"></div>
        </div>
        
        <!-- Inspector de Clipboard -->
        <div class="inspector">
            <h3>üîç Clipboard Inspector</h3>
            <p>Cole aqui (Ctrl/Cmd+V) para ver o que foi copiado:</p>
            <textarea id="clipboardInspector" placeholder="Cole aqui para inspecionar o conte√∫do do clipboard..."></textarea>
            <button onclick="clearInspector()">Limpar</button>
            <button onclick="inspectClipboard()">Ler Clipboard</button>
        </div>
    </div>
    
    <!-- Elementos ocultos para manipula√ß√£o -->
    <div class="hidden-elements">
        <div id="hiddenCopy" contenteditable="true"></div>
        <textarea id="hiddenTextarea"></textarea>
    </div>
    
    <!-- Status -->
    <div id="status" class="status"></div>
    
    <script>
        // Vari√°vel global para armazenar o base64
        let figmaBase64 = '';
        
        // Carregar o base64 do arquivo
        async function loadBase64() {
            if (figmaBase64) return figmaBase64;
            
            try {
                const response = await fetch('card.base64.txt');
                figmaBase64 = await response.text();
                figmaBase64 = figmaBase64.trim(); // Remove quebras de linha
                return figmaBase64;
            } catch (error) {
                console.error('Erro ao carregar base64:', error);
                // Fallback com um base64 m√≠nimo para teste
                figmaBase64 = 'UEsDBAoAAAAAABZdWU8AAAAAAAAAAAAAAAAJAAAAX19NQUNPU1gvUEsBAhQAChQAAAAAFl1ZTwAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAEADtQQAAAABfX01BQ09TWC9QSwUGAAAAAAEAAQA3AAAAJwAAAAAA';
                return figmaBase64;
            }
        }
        
        // Fun√ß√£o para mostrar status
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type} show`;
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }
        
        // Fun√ß√£o para mostrar resultado
        function showResult(methodId, message, type = 'success') {
            const result = document.getElementById(`result${methodId}`);
            result.textContent = message;
            result.className = `result ${type}`;
            result.style.display = 'block';
        }
        
        // M√©todo 1: ClipboardItem com MIME customizado
        async function copyMethod1() {
            try {
                const base64 = await loadBase64();
                const figmaPayload = `<!--(figma)${base64}(/figma)-->`;
                
                // HTML estruturado como observado em sites funcionais
                const html = `<div data-buffer="${figmaPayload}" contenteditable="true" style="white-space: pre;">Figma Component</div>`;
                
                const clipboardItem = new ClipboardItem({
                    'text/html': new Blob([html], { type: 'text/html' }),
                    'text/plain': new Blob([figmaPayload], { type: 'text/plain' }),
                    'application/figma-node': new Blob([base64], { type: 'application/figma-node' })
                });
                
                await navigator.clipboard.write([clipboardItem]);
                showResult(1, '‚úÖ Copiado com ClipboardItem + MIME customizado');
                showStatus('M√©todo 1: Copiado! Cole no Figma Desktop');
                
            } catch (error) {
                showResult(1, `‚ùå Erro: ${error.message}`, 'error');
                console.error('M√©todo 1 erro:', error);
            }
        }
        
        // M√©todo 2: execCommand com sele√ß√£o
        async function copyMethod2() {
            try {
                const base64 = await loadBase64();
                const figmaPayload = `<!--(figma)${base64}(/figma)-->`;
                
                const hiddenDiv = document.getElementById('hiddenCopy');
                hiddenDiv.innerHTML = `<span data-buffer="${figmaPayload}" contenteditable="true" style="white-space: pre;">Figma Component</span>`;
                
                // Selecionar o conte√∫do
                const range = document.createRange();
                range.selectNodeContents(hiddenDiv);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                // Copiar usando execCommand
                const success = document.execCommand('copy');
                selection.removeAllRanges();
                
                if (success) {
                    showResult(2, '‚úÖ Copiado com execCommand');
                    showStatus('M√©todo 2: Copiado! Cole no Figma Desktop');
                } else {
                    throw new Error('execCommand falhou');
                }
                
            } catch (error) {
                showResult(2, `‚ùå Erro: ${error.message}`, 'error');
                console.error('M√©todo 2 erro:', error);
            }
        }
        
        // M√©todo 3: Multi-MIME com Data URLs
        async function copyMethod3() {
            try {
                const base64 = await loadBase64();
                const figmaPayload = `<!--(figma)${base64}(/figma)-->`;
                const dataUrl = `data:application/figma-node;base64,${base64}`;
                
                const html = `
                    <div data-buffer="${figmaPayload}" data-figma-url="${dataUrl}" contenteditable="true" style="white-space: pre;">
                        <meta name="figma-component" content="${base64}">
                        Figma Component
                    </div>
                `;
                
                const clipboardItem = new ClipboardItem({
                    'text/html': new Blob([html], { type: 'text/html' }),
                    'text/plain': new Blob([figmaPayload], { type: 'text/plain' }),
                    'text/uri-list': new Blob([dataUrl], { type: 'text/uri-list' })
                });
                
                await navigator.clipboard.write([clipboardItem]);
                showResult(3, '‚úÖ Copiado com Data URLs');
                showStatus('M√©todo 3: Copiado! Cole no Figma Desktop');
                
            } catch (error) {
                showResult(3, `‚ùå Erro: ${error.message}`, 'error');
                console.error('M√©todo 3 erro:', error);
            }
        }
        
        // M√©todo 4: Headers e Metadata Figma
        async function copyMethod4() {
            try {
                const base64 = await loadBase64();
                const figmaPayload = `<!--(figma)${base64}(/figma)-->`;
                
                // Simular estrutura mais complexa com metadados
                const html = `
                    <div 
                        data-buffer="${figmaPayload}"
                        data-figma-origin="figma.com"
                        data-figma-type="component"
                        data-figma-version="1.0"
                        contenteditable="true" 
                        style="white-space: pre; -webkit-user-select: all; user-select: all;"
                    >
                        <figma-component>${base64}</figma-component>
                        Component copied from Figma
                    </div>
                `;
                
                // Adicionar ao DOM temporariamente
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                document.body.appendChild(tempDiv);
                
                // Selecionar e copiar
                const range = document.createRange();
                range.selectNodeContents(tempDiv);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                const success = document.execCommand('copy');
                selection.removeAllRanges();
                document.body.removeChild(tempDiv);
                
                if (success) {
                    showResult(4, '‚úÖ Copiado com metadata Figma');
                    showStatus('M√©todo 4: Copiado! Cole no Figma Desktop');
                } else {
                    throw new Error('C√≥pia falhou');
                }
                
            } catch (error) {
                showResult(4, `‚ùå Erro: ${error.message}`, 'error');
                console.error('M√©todo 4 erro:', error);
            }
        }
        
        // M√©todo 5: Abordagem h√≠brida
        async function copyMethod5() {
            try {
                const base64 = await loadBase64();
                const figmaPayload = `<!--(figma)${base64}(/figma)-->`;
                
                // Tentar primeiro com ClipboardItem
                if (navigator.clipboard && navigator.clipboard.write) {
                    const html = `<span data-buffer="${figmaPayload}" contenteditable="true" style="white-space: pre;">Figma Component</span>`;
                    const clipboardItem = new ClipboardItem({
                        'text/html': new Blob([html], { type: 'text/html' }),
                        'text/plain': new Blob([figmaPayload], { type: 'text/plain' })
                    });
                    
                    await navigator.clipboard.write([clipboardItem]);
                    showResult(5, '‚úÖ H√≠brido: ClipboardItem funcionou');
                } else {
                    // Fallback para execCommand
                    const textarea = document.getElementById('hiddenTextarea');
                    textarea.value = figmaPayload;
                    textarea.select();
                    
                    const success = document.execCommand('copy');
                    if (!success) throw new Error('Fallback falhou');
                    
                    showResult(5, '‚úÖ H√≠brido: Fallback execCommand');
                }
                
                showStatus('M√©todo 5: Copiado! Cole no Figma Desktop');
                
            } catch (error) {
                showResult(5, `‚ùå Erro: ${error.message}`, 'error');
                console.error('M√©todo 5 erro:', error);
            }
        }
        
        // Fun√ß√£o para limpar o inspector
        function clearInspector() {
            document.getElementById('clipboardInspector').value = '';
        }
        
        // Fun√ß√£o para tentar ler o clipboard
        async function inspectClipboard() {
            try {
                if (navigator.clipboard && navigator.clipboard.readText) {
                    const text = await navigator.clipboard.readText();
                    document.getElementById('clipboardInspector').value = text;
                    showStatus('Clipboard lido com sucesso');
                } else {
                    showStatus('Clipboard API n√£o dispon√≠vel', 'warning');
                }
            } catch (error) {
                showStatus(`Erro ao ler clipboard: ${error.message}`, 'error');
            }
        }
        
        // Event listener para paste no inspector
        document.getElementById('clipboardInspector').addEventListener('paste', (e) => {
            setTimeout(() => {
                const content = e.target.value;
                if (content.includes('<!--(figma)')) {
                    showStatus('‚úÖ Conte√∫do Figma detectado!', 'success');
                } else {
                    showStatus('‚ÑπÔ∏è Conte√∫do colado (sem formato Figma)', 'warning');
                }
            }, 100);
        });
        
        // Inicializar carregando o base64
        loadBase64().then(() => {
            console.log('Base64 carregado:', figmaBase64.substring(0, 50) + '...');
        });
    </script>
</body>
</html>